From: Al Viro <viro@zeniv.linux.org.uk>
Date: Sat, 2 Apr 2016 14:56:58 -0400
Subject: do_splice_to(): cap the size before passing to ->splice_read()
Origin: https://git.kernel.org/linus/03cc0789a690eb9ab07070376252961caeae7441

pipe capacity won't exceed 2G anyway.

Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
---
 fs/splice.c | 3 +++
 1 file changed, 3 insertions(+)

--- a/fs/splice.c
+++ b/fs/splice.c
@@ -1144,6 +1144,9 @@ long do_splice_to(struct file *in, loff_
 	if (unlikely(ret < 0))
 		return ret;
 
+	if (unlikely(len > MAX_RW_COUNT))
+		len = MAX_RW_COUNT;
+
 	if (in->f_op->splice_read)
 		splice_read = in->f_op->splice_read;
 	else
